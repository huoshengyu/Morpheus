<launch>

    <!-- Launch teleop twist -->
    <arg name="robot_model"         default="ur5e"/>
    <arg name="threshold"           default="0.75"/>
    <arg name="controller_type"     default="xbox360"/>
    <arg name="gripper_type"        default="robotiq"/>
    <arg name="twist_topic"         default="twist_controller/command"/>
    <arg name="arm_group"           default="arm"/>
    <arg name="frame_id"            default="world"/>
    <arg name="end_effector"        default="tcp_link"/>

    <node 
        pkg="joy" 
        type="joy_node"
        name="joy_node"
        output="screen">
        <param name="dev" type="str" value="/dev/input/js0"/>
        <param name="dev_ff" value="/dev/input/event7"/>
        <param name="default_trig_val" value="true"/>
    </node>

    <group if="$(eval arg('robot_model') == 'vx300s')">
        <node
            pkg="interbotix_xsarm_joy"
            type="xsarm_joy"
            name="xsarm_joy"
            output="screen">
            <param name="threshold" value="$(arg threshold)"/>
            <param name="controller" value="$(arg controller_type)"/>
            <remap from="commands/joy_raw" to="joy"/>
        </node>

        <node
            pkg="interbotix_xsarm_joy"
            type="xsarm_robot"
            name="xsarm_robot"
            output="screen">
            <param name="robot_model" value="$(arg robot_model)"/>
        </node>
    </group>

    <node pkg="morpheus_teleop" type="teleop_main.py" name="teleop_main" output="screen">
        <param name="robot_model"       value="$(arg robot_model)"/>
        <param name="controller_type"   value="$(arg controller_type)"/>
        <param name="gripper_type"      value="$(arg gripper_type)"/>
        <param name="twist_topic"       value="$(arg twist_topic)"/>
        <param name="arm_group"         value="$(arg arm_group)"/>
    </node>

    <!-- Launch Twist converter-->
    <include file="$(find morpheus_teleop)/launch/twist_converter.launch">
        <arg name="twist_topic"         value="$(arg twist_topic)"/>
        <arg name="pose_topic"          value="target_frame"/>
        <arg name="wrench_topic"        value="target_wrench"/>
        <arg name="frame_id"            value="$(arg frame_id)"/>
        <arg name="end_effector"        value="$(arg end_effector)"/>
    </include>

</launch>